# Web 2D 打字小游戏设计文档

## 1. 项目概览
- **名称**：Little Key Rangers（暂定）
- **类型**：基于浏览器的 2D 打字闯关/无尽小游戏。
- **目标平台**：桌面端现代浏览器（Chromium、Firefox、Safari）。
- **主要引擎**：Phaser 3。
- **技术栈**：TypeScript、Vite、Phaser 3、HTML5 Canvas。
- **目标用户**：希望通过轻松的小游戏锻炼打字速度与准确率的休闲玩家。

## 2. 核心玩法与体验
1. 玩家在限定生命值或倒计时约束下，通过键入屏幕上的单词击败敌人或阻止障碍靠近。
2. 正确输入单词可击败敌人、累积连击、获得分数奖励；输入错误会重置连击、扣除生命或时间。
3. 游戏提供多个关卡与词库难度，逐步提升单词长度、敌人速度与特殊机制。
4. 设有排行榜、成就与练习模式，鼓励玩家重复挑战、提升打字技巧。

## 3. 系统架构与目录规划
```
/src
  /assets
    /audio
    /fonts
    /images
  /config
    wordPools/
      easy.json
      medium.json
      hard.json
    stages.json
  /core
    GameConfig.ts
    BootScene.ts
    UIScene.ts
    AudioManager.ts
    EventBus.ts
    StorageService.ts
  /entities
    Enemy.ts
    PlayerStats.ts
    WordBubble.ts
  /states
    MenuScene.ts
    PlayScene.ts
    PauseScene.ts
    ResultScene.ts
    EndlessScene.ts
  /systems
    TypingSystem.ts
    EnemySpawner.ts
    ComboSystem.ts
    ScoreSystem.ts
  /ui
    components/
      Button.ts
      Dialog.ts
      ProgressBar.ts
  index.html
  main.ts
```

- **核心模块划分**
  - `core`：Phaser 配置、全局系统与辅助类。
  - `states`：游戏状态/场景（菜单、游戏、结算等）。
  - `systems`：与场景解耦的逻辑系统（输入、评分、生成等）。
  - `entities`：游戏实体的数据与行为描述。
  - `config`：词库、关卡、任务等数据配置。
  - `ui`：UI 组件封装（按钮、进度条、对话框等）。

## 4. 场景与状态流程
1. **BootScene**：预加载资源（图片、音效、字体、配置 JSON），完成后跳转到 `MenuScene`。
2. **MenuScene**：展示标题、模式选择、设置按钮。点击“开始游戏”或按键后进入 `PlayScene` 或其他模式。
3. **PlayScene**：根据选定关卡配置生成敌人，绑定 `UIScene` 显示生命、得分、连击等 HUD 信息。
4. **PauseScene**：暂停界面，显示继续、重开、返回主菜单等选项。
5. **ResultScene**：展示统计数据（分数、准确率、连击、奖励），存档并提供分享/重玩按钮。
6. **EndlessScene**：无尽模式，敌人随时间加速，持续挑战直至失败。

## 5. 核心系统设计
### 5.1 TypingSystem（输入系统）
- 监听键盘事件，维护玩家当前输入缓冲。
- 与当前目标单词对比，高亮正确字符，输入错误提供反馈（声音/视觉）。
- 支持 Backspace 撤销、特殊键映射以及多目标切换（如 Tab）。
- 通过事件触发 `typing:correct`、`typing:miss`、`typing:complete` 等反馈。

### 5.2 EnemySpawner（敌人生成）
- 按关卡配置（波次、路径、速度）生成敌人对象。
- 控制同屏敌人数、重用对象池，支持 Boss 或特殊敌人。
- 敌人到达终点触发伤害或扣时，通过事件通知 `PlayerStats`。

### 5.3 Score & Combo System（评分与连击）
- 成功击败敌人累积分数，连击提升倍率。
- 统计输入字符数、错误数，用于计算准确率、WPM、最高连击。
- 连击达到阈值触发奖励（清屏、护盾、分数加成）。

### 5.4 PlayerStats（玩家状态）
- 维护生命、护盾、倒计时、技能能量等。
- 提供接口响应敌人攻击、输入失误等事件，触发游戏结束条件。

### 5.5 AudioManager
- 统一管理背景音乐与音效，支持音量调节、静音。
- 提供 `playKeySound`、`playSuccess`、`playFail` 等封装方法。

### 5.6 StorageService
- 基于 LocalStorage 保存最高分、最佳准确率、连击纪录、设置与解锁内容。
- 预留接口扩展云端同步或排行榜服务。

## 6. 数据配置
### 6.1 关卡配置
- `config/stages.json` 定义背景、音乐、敌人波次、胜负条件等。
- 示例：
```json
{
  "id": "stage1",
  "name": "训练场",
  "background": "bg_training",
  "music": "track_easy",
  "wordPool": "easy",
  "spawn": {
    "waves": [
      { "time": 0, "count": 5, "interval": 1500, "path": "straight" },
      { "time": 15000, "count": 8, "interval": 1200, "path": "zigzag" }
    ],
    "maxConcurrent": 4
  },
  "winCondition": { "type": "defeatAll" },
  "lossCondition": { "type": "hp", "hp": 3 }
}
```

### 6.2 词库配置
- `config/wordPools/*.json` 管理不同难度与语言的词库。
- 示例 `easy.json`：
```json
{
  "language": "en",
  "difficulty": "easy",
  "words": ["cat", "sun", "tree", "code", "game"]
}
```

### 6.3 成就/任务
- 可选 `config/achievements.json`，记录解锁条件与奖励。
- 示例：`{"id": "combo_50", "desc": "连击达到50", "reward": "badge_combo_master"}`。

## 7. UI 与音效
- **HUD**：显示生命/时间、分数、连击、WPM、准确率、技能冷却。
- **菜单**：标题、模式选择、设置（音量、语言、主题、词库管理）。
- **反馈**：输入正确/错误的视觉与听觉效果、连击奖励动画、敌人击败特效。

## 8. 游戏循环示意
```ts
class PlayScene extends Phaser.Scene {
  private typingSystem!: TypingSystem;
  private enemySpawner!: EnemySpawner;
  private scoreSystem!: ScoreSystem;
  private playerStats!: PlayerStats;

  create(config: StageConfig) {
    this.playerStats = new PlayerStats(config.lossCondition);
    this.enemySpawner = new EnemySpawner(this, config.spawn, config.wordPool);
    this.typingSystem = new TypingSystem(this.input.keyboard, this.enemySpawner);
    this.scoreSystem = new ScoreSystem();

    EventBus.on('enemy:cleared', this.onEnemyCleared, this);
    EventBus.on('enemy:breached', this.onEnemyBreached, this);
    EventBus.on('typing:miss', this.onMiss, this);

    this.scene.run('UIScene', { stats: this.playerStats });
  }

  update(time: number, delta: number) {
    this.enemySpawner.update(time, delta);
    this.playerStats.update(delta);

    if (this.playerStats.isDefeated()) {
      this.scene.stop('UIScene');
      this.scene.start('ResultScene', { score: this.scoreSystem.summary() });
    }
  }
}
```

## 9. 里程碑规划
1. **原型阶段**
   - 初始化项目、场景切换、基础输入判定与单关卡原型。
2. **核心功能实现**
   - 完成 TypingSystem、EnemySpawner、Score/Combo、HUD UI。
   - 实现音效、动画反馈。
3. **内容扩展与打磨**
   - 增加关卡配置、难度曲线、成就与排行榜。
   - 丰富词库、支持多语言与练习模式。
4. **优化与发布**
   - 性能优化（对象池、粒子控制），完善响应式布局。
   - 打包部署、编写用户指南。

## 10. 可选扩展
- 实时/异步多人竞速模式。
- 自定义词库导入与数据分析（常错字母统计）。
- 主题皮肤、角色收集系统。
- 移动端适配与触屏输入方案。

## 11. 下一步计划
1. 初始化 Vite + Phaser + TypeScript 项目结构。
2. 实现 BootScene、MenuScene、PlayScene 的最小可运行原型。
3. 构建基础 TypingSystem、ScoreSystem 与 HUD。
4. 按照设计文档逐步扩展敌人生成、关卡配置和音效等功能。
